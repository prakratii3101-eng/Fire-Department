<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Announcements | Admin</title>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<aside class="sidebar">
  <div class="sidebar-brand"><span class="brand-icon">ğŸ”¥</span><div><div class="brand-name">Fire Dept</div><div class="brand-sub">Admin Portal</div></div></div>
  <nav>
    <p class="nav-label">Main</p>
    <a href="{{ url_for('admin_dashboard') }}" class="nav-item">ğŸ“Š Dashboard</a>
    <a href="{{ url_for('admin_users') }}" class="nav-item">ğŸ‘¥ Manage Users</a>
    <a href="{{ url_for('admin_applications') }}" class="nav-item">ğŸ“‹ All Applications</a>
    <p class="nav-label">Finance & Certs</p>
    <a href="{{ url_for('admin_fees') }}" class="nav-item">ğŸ’° Fee Management</a>
    <a href="{{ url_for('admin_nocs') }}" class="nav-item">ğŸ“œ NOC Certificates</a>
    <p class="nav-label">System</p>
    <a href="{{ url_for('admin_announcements') }}" class="nav-item active">ğŸ“¢ Announcements</a>
    <a href="{{ url_for('admin_audit') }}" class="nav-item">ğŸ” Audit Logs</a>
    <a href="{{ url_for('admin_reports') }}" class="nav-item">ğŸ“ˆ Reports</a>
    <a href="{{ url_for('admin_settings') }}" class="nav-item">âš™ï¸ Settings</a>
  </nav>
  <div class="sidebar-footer"><a href="{{ url_for('logout') }}" class="logout-btn">ğŸšª Logout</a></div>
</aside>
<main class="main-content">
  {% with messages = get_flashed_messages(with_categories=true) %}{% if messages %}{% for cat, msg in messages %}
  <div class="flash flash-{{ cat }}"><span class="flash-icon">{% if cat=='success' %}âœ…{% elif cat=='error' %}âŒ{% else %}â„¹ï¸{% endif %}</span><span class="flash-text">{{ msg }}</span><button class="flash-close" onclick="this.parentElement.remove()">âœ•</button></div>
  {% endfor %}{% endif %}{% endwith %}

  <div class="page-header">
    <div><h2>Announcements</h2><p>Broadcast notices to applicants, officers, or all users.</p></div>
    <button class="btn-primary" onclick="document.getElementById('composeModal').classList.add('active')">ğŸ“¢ New Announcement</button>
  </div>

  <!-- Compose card -->
  <div class="card" style="margin-bottom:24px">
    <h3>Broadcast Message</h3>
    <form method="POST" action="{{ url_for('admin_send_announcement') }}">
      <div class="form-grid" style="margin-bottom:16px">
        <div class="form-group" style="margin-bottom:0">
          <label>Title</label>
          <input type="text" name="title" placeholder="Announcement title" required>
        </div>
        <div class="form-group" style="margin-bottom:0">
          <label>Target Audience</label>
          <select name="audience">
            <option value="all">All Users</option>
            <option value="applicants">Applicants Only</option>
            <option value="officers">Officers Only</option>
          </select>
        </div>
      </div>
      <div class="form-group" style="margin-bottom:16px">
        <label>Message</label>
        <textarea name="message" rows="4" placeholder="Write your announcement hereâ€¦" required></textarea>
      </div>
      <div class="form-group" style="margin-bottom:20px">
        <label>Priority</label>
        <select name="priority">
          <option value="normal">Normal</option>
          <option value="high">High</option>
          <option value="urgent">Urgent</option>
        </select>
      </div>
      <div style="display:flex;justify-content:flex-end">
        <button type="submit" class="btn-primary">Send Announcement</button>
      </div>
    </form>
  </div>

  <!-- Past announcements -->
  <div class="section-title">Sent Announcements</div>
  <div style="display:flex;flex-direction:column;gap:12px">
    {% for ann in announcements %}
    <div class="card" style="margin-bottom:0;padding:20px 24px">
      <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:16px;margin-bottom:10px">
        <div>
          <div style="display:flex;align-items:center;gap:10px;margin-bottom:4px">
            <span style="font-family:'Rajdhani',sans-serif;font-size:16px;font-weight:700;color:var(--text-primary)">{{ ann.title }}</span>
            <span class="priority-badge priority-{{ ann.priority|lower }}">{{ ann.priority }}</span>
            <span class="status-pill status-scheduled" style="font-size:10px">{{ ann.audience }}</span>
          </div>
          <p style="font-size:14px;color:var(--text-secondary);line-height:1.6">{{ ann.message }}</p>
        </div>
        <div style="text-align:right;flex-shrink:0">
          <div style="font-size:12px;color:var(--ember-bright);font-family:'Rajdhani',sans-serif;font-weight:700">{{ ann.created_at.strftime('%d %b %Y, %H:%M') if ann.created_at else 'â€”' }}</div>
          <div style="font-size:11px;color:var(--text-muted);margin-top:2px">By {{ ann.created_by }}</div>
          <div style="font-size:11px;color:var(--text-muted);margin-top:4px">{{ ann.recipient_count }} recipients</div>
        </div>
      </div>
      <form method="POST" action="{{ url_for('admin_delete_announcement', ann_id=ann.ann_id) }}" style="margin:0;text-align:right">
        <button type="submit" class="btn-reject" style="font-size:11px;padding:3px 10px" onclick="return confirm('Delete this announcement?')">Delete</button>
      </form>
    </div>
    {% else %}
    <div style="text-align:center;padding:48px;color:var(--text-muted)">No announcements sent yet.</div>
    {% endfor %}
  </div>
</main>
</body>
</html>